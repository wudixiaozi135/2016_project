var AssetAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getAsset=function(e,t,i){function h(h){t.call(i,h,e)}if(RES.hasRes(e)){var s=RES.getRes(e);s?h(s):RES.getResAsync(e,h,this)}else RES.getResByUrl(e,h,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var i=(__define,t),h=i.prototype;return h.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},h.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var i=(__define,t),h=i.prototype;return h.createChildren=function(){e.prototype.createChildren.call(this);var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},h.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},h.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},h.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},h.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},h.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},h.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},h.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},h.startCreateScene=function(){var e=new GameScene;this.addChild(e),e.horizontalCenter=0,e.bottom=0},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),i=t.prototype;return i.getTheme=function(e,t,i,h){function s(e){t.call(h,e)}function a(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),i.call(h))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(e,s,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);var ShapeData=function(){function e(){this.row=0,this.column=0}var t=(__define,e),i=t.prototype;return i.update=function(e,t){this.row=e,this.column=t},e}();egret.registerClass(ShapeData,"ShapeData");var ColorShape=function(e){function t(t){e.call(this),this.w=0,this.h=0,this._row=0,this._column=0,this._data=0,this._state=0,this.shapeData=new ShapeData,this._type=t,this.touchChildren=!1,this.cacheAsBitmap=!0}__extends(t,e);var i=__define,h=t,s=h.prototype;return i(s,"data",function(){return this._data},function(e){this._data=e}),i(s,"type",function(){return this._type}),s.createChildren=function(){e.prototype.createChildren.call(this),this.w=GameData.shapeW,this.h=GameData.shapeH;var t=new egret.Bitmap;this.addChild(t),this.shape=new eui.Rect;var i;this.type==ColorShapeType.blue?i="blueStar":this.type==ColorShapeType.red?i="redStar":this.type==ColorShapeType.green?i="greenStar":this.type==ColorShapeType.yellow?i="yellowStar":this.type==ColorShapeType.purple&&(i="purpleStar"),i&&(t.width=this.w,t.height=this.h,t.texture=RES.getRes(i)),this.width=this.w,this.height=this.h,this.addChildAt(this.shape,0),this.shape.percentWidth=100,this.shape.percentHeight=100,this.shape.horizontalCenter=0,this.shape.verticalCenter=0,this.hightlight(!1)},i(s,"state",function(){return this._state},function(e){this._state=e,this.hightlight(1==this._state?!0:!1)}),s.hightlight=function(e){void 0===e&&(e=!0),this.shape.visible=e,e?(this.shape.strokeWeight=2,this.shape.strokeColor=16777215,this.shape.strokeAlpha=1):(this.shape.strokeWeight=1,this.shape.strokeColor=16777215,this.shape.strokeAlpha=0)},s.setData=function(e,t){this.row=e,this.column=t,this.shapeData.update(e,t)},i(s,"row",function(){return this._row},function(e){this._row=e,this.shapeData.row=e}),i(s,"column",function(){return this._column},function(e){this._column=e,this.shapeData.column=e}),t}(eui.Group);egret.registerClass(ColorShape,"ColorShape");var ColorShapeType;!function(e){e[e.red=1]="red",e[e.green=2]="green",e[e.blue=3]="blue",e[e.yellow=4]="yellow",e[e.purple=5]="purple"}(ColorShapeType||(ColorShapeType={}));var GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.shapeH=50,e}();egret.registerClass(GameData,"GameData");var GameScene=function(e){function t(){e.call(this),this.column=10,this.row=10,this.index=10,this.flagShapes=[],this.findShapes=[],this.columnShapes=[],this.particlePool=[],this.animateCount=0,this.doubleClick=0,GameData.shapeW=Math.floor(egret.MainContext.instance.stage.stageWidth/10)}__extends(t,e);var i=(__define,t),h=i.prototype;return h.createChildren=function(){e.prototype.createChildren.call(this),this.startGame()},h.startGame=function(){this.particlePool.length>0&&(this.particlePool.forEach(function(e,t,i){this.parent.contains(e)&&this.parent.removeChild(e),e.stop(!0),e=null},this),this.particlePool.length=0),this.colorShapeVec=[[],[],[],[],[],[],[],[],[],[]],this.index=10,this.addRowShape(this.index)},h.addRowShape=function(e){e-=1;for(var t=0;10>t;t++){var i=new ColorShape(Math.floor(4*Math.random())+1);i.setData(e,t),i.data=1,this.colorShapeVec[e][t]=i,this.addChild(i),i.x=t*i.width,i.alpha=0,TweenMax.to(i,.2,{y:e*i.height,alpha:1,onComplete:this.onTweenComplete.bind(this)})}this.index>1&&TweenMax.delayedCall(.02*e+.1,function(){this.index--,this.addRowShape(this.index)}.bind(this))},h.onTweenComplete=function(){this.animateCount++,this.animateCount>=100&&(this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onTouchClick,this),this.animateCount=0)},h.onTouchClick=function(e){var t=Math.floor((e.stageX-this.x)/GameData.shapeW),i=Math.floor((e.stageY-this.y)/GameData.shapeH),h=e.target;this.selectTarget&&(this.selectTarget.state=0,this.selectTarget=null),this.selectTarget=h,1!=h.state&&(h.state=1);var s=this.priorityCheck(i,t);return s?void this.handlerClick(i,t,h):void this.resetState()},h.resetState=function(){this.findShapes.length>0&&(this.findShapes.forEach(function(e,t,i){e.state=0,this.colorShapeVec[e.row][e.column]=e},this),this.findShapes.length>0&&(this.findShapes.length=0),this.flagShapes.length>0&&(this.flagShapes.length=0),this.columnShapes.length=0,this.doubleClick=0)},h.handlerClick=function(e,t,i){if(this.findShapes.length>0){var h=this.findShapes.lastIndexOf(i);if(-1==h)return this.resetState(),void this.traverseShape(e,t)}else if(this.traverseShape(e,t),this.findShapes.length<=0)return this.flagShapes.length=0,this.columnShapes.length=0,void(this.doubleClick=0);this.doubleClick++,this.doubleClick>=2&&(this.doubleClick=0,this.findShapes.length>0&&(this.findShapes.forEach(function(e,t,i){this.removeChild(e),this.colorShapeVec[e.row][e.column]=null,e=null},this),this.freeFallDown(),this.resetGame()))},h.resetGame=function(){var e,t=0,i=0;if(this.colorShapeVec.length>0){var h=!0;for(t=0;t<this.row;t++){for(i=0;i<this.column;i++)if(e=this.colorShapeVec[t][i],e&&(this.traverseShape(e.row,e.column),this.findShapes.length>0)){this.findShapes.forEach(function(e,t,i){e.state=0,this.colorShapeVec[e.row][e.column]=e},this),this.findShapes.length>0&&(this.findShapes.length=0),this.flagShapes.length>0&&(this.flagShapes.length=0),this.columnShapes.length=0,h=!1;break}if(0==h)break}if(h){var s=[];for(t=0;t<this.row;t++)for(i=0;i<this.column;i++)e=this.colorShapeVec[t][i],e&&s.push(e);if(s.length>0){var a=RES.getRes("effectStar"),o=RES.getRes("effectStar_json");s.forEach(function(e,t,i){this.contains(e)&&this.removeChild(e)},this)}var n=new particle.GravityParticleSystem(a,o);this.parent.addChild(n),n.maxParticles=100,n.start(),n.emitterX=.5*this.parent.width,n.emitterY=.5*this.parent.height,this.particlePool.push(n),this.findShapes.length>0&&(this.findShapes.length=0),this.flagShapes.length>0&&(this.flagShapes.length=0),this.columnShapes.length=0,TweenMax.delayedCall(3,this.startGame.bind(this))}}},h.freeFallDown=function(){if(this.columnShapes&&this.columnShapes.length>0){var e=[];if(this.columnShapes.forEach(function(t,i,h){e.push(t[0].column)}),e.length>0){for(var t=0,i=void 0,h=void 0,s=void 0,a=e.concat(),o=0;e.length>0;)for(t=e.pop(),o=this.row-1;o>=0;o--)i=this.colorShapeVec[o][t],i||(h=this.findShape(o,t),h&&(o=this.row));for(var n=0,r=0;a.length>0;)t=a.pop(),s=this.columnArrIsNull(t),s&&(r++,n=t);if(r>0){var l=this.countSize(t,1),c=this.countSize(t,2);c>=l?this.leftToRight(n,r):this.rightToLeft(n,r)}}this.columnShapes.length=0}this.findShapes.length>0&&(this.findShapes.length=0),this.flagShapes.length>0&&(this.flagShapes.length=0)},h.countSize=function(e,t){void 0===t&&(t=1);var i=0,h=0,s=0;if(1==t)for(h=e;h>=0;h--)for(s=this.row-1;s>=0;s--)this.colorShapeVec[s][h]&&i++;else for(h=this.column-1;h>=e;h--)for(s=this.row-1;s>=0;s--)this.colorShapeVec[s][h]&&i++;return i},h.leftToRight=function(e,t){for(var i,h=e;h>=0;h--)for(var s=this.row-1;s>=0;s--)i=this.colorShapeVec[s][h],i&&(this.colorShapeVec[i.row][i.column]=null,i.column+=t,TweenMax.to(i,.3,{x:GameData.shapeW*i.column}),this.colorShapeVec[i.row][i.column]=i)},h.rightToLeft=function(e,t){for(var i,h=e;h<=this.column-1;h++)for(var s=this.row-1;s>=0;s--)i=this.colorShapeVec[s][h],i&&(this.colorShapeVec[i.row][i.column]=null,i.column-=t,TweenMax.to(i,.3,{x:GameData.shapeW*i.column}),this.colorShapeVec[i.row][i.column]=i)},h.columnArrIsNull=function(e){for(var t=!0,i=this.row-1;i>=0;i--)if(this.colorShapeVec[i][e]){t=!1;break}return t},h.findShape=function(e,t){for(var i=null,h=e;h>=0;h--)if(i=this.colorShapeVec[h][t],i&&1==i.data){this.colorShapeVec[i.row][t]=null,i.row++,TweenMax.to(i,.3,{y:i.row*GameData.shapeH}),this.colorShapeVec[i.row][t]=i;break}return i},h.priorityCheck=function(e,t){var i=this.colorShapeVec[e][t];if(!i||0==i.data)return!1;var h;return i.column-1>=0&&(h=this.colorShapeVec[e][i.column-1],h&&h.type==i.type)?!0:i.column+1<=9&&(h=this.colorShapeVec[e][i.column+1],h&&h.type==i.type)?!0:i.row-1>=0&&(h=this.colorShapeVec[i.row-1][t],h&&h.type==i.type)?!0:i.row+1<=9&&(h=this.colorShapeVec[i.row+1][t],h&&h.type==i.type)?!0:!1},h.traverseShape=function(e,t){var i=this.colorShapeVec[e][t];if(i&&0!=i.data){this.addShape(this.flagShapes,i);var h;if(i.column-1>=0&&(h=this.colorShapeVec[e][i.column-1],h&&h.type==i.type&&(h.state=i.state,this.addShape(this.findShapes,h))),i.column+1<=9&&(h=this.colorShapeVec[e][i.column+1],h&&h.type==i.type&&(h.state=i.state,this.addShape(this.findShapes,h))),i.row-1>=0&&(h=this.colorShapeVec[i.row-1][t],h&&h.type==i.type&&(h.state=i.state,this.addShape(this.findShapes,h))),i.row+1<=9&&(h=this.colorShapeVec[i.row+1][t],h&&h.type==i.type&&(h.state=i.state,this.addShape(this.findShapes,h))),this.flagShapes.length>0&&this.findShapes.length>0&&this.flagShapes.length==this.findShapes.length&&this.equalArr(this.flagShapes,this.findShapes))for(var s=void 0,a=0;a<this.flagShapes.length;a++)s=this.flagShapes[a],this.columnShapes[s.column]||(this.columnShapes[s.column]=[]),this.columnShapes[s.column].push(s.shapeData);else if(this.findShapes.length>0){var o=this;this.findShapes.forEach(function(e,t,i){-1==o.flagShapes.indexOf(e)&&o.traverseShape(e.row,e.column)})}}},h.equalArr=function(e,t){for(var i=!0,h=0;h<e.length;h++)if(-1==t.lastIndexOf(e[h])){i=!1;break}return i},h.addShape=function(e,t){var i=e.lastIndexOf(t);-1==i&&e.push(t)},h.containShape=function(e,t){return-1!=e.lastIndexOf(t)},t}(eui.Group);egret.registerClass(GameScene,"GameScene");
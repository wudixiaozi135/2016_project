var AssetAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getAsset=function(e,t,a){function i(i){t.call(a,i,e)}if(RES.hasRes(e)){var r=RES.getRes(e);r?i(r):RES.getResAsync(e,i,this)}else RES.getResByUrl(e,i,this,RES.ResourceItem.TYPE_IMAGE)},e}();egret.registerClass(AssetAdapter,"AssetAdapter",["eui.IAssetAdapter"]);var ColorUtils=function(){function e(){}var t=(__define,e);t.prototype;return e.getColorValue=function(e,t,a){var i=0;return i=e<<16|t<<8|a},e}();egret.registerClass(ColorUtils,"ColorUtils");var xd;!function(e){var t=egret.EventDispatcher,a=function(){function a(){}var i=(__define,a);i.prototype;return a.addEventListener=function(e,t,i,r,s){a.dispatcher.addEventListener(e,t,i,r,s)},a.once=function(e,t,i,r,s){a.dispatcher.once(e,t,i,r,s)},a.removeEventListener=function(e,t,i,r){a.dispatcher.removeEventListener(e,t,i,r)},a.hasEventListener=function(e){return a.hasEventListener(e)},a.dispatchEvent=function(t,i){return void 0===i&&(i=null),a.dispatcher.dispatchEvent(new e.GameEvent(t,i))},a.willTrigger=function(e){return a.dispatcher.willTrigger(e)},a.dispatcher=new t,a}();e.GameDispatcher=a,egret.registerClass(a,"xd.GameDispatcher")}(xd||(xd={}));var xd;!function(e){var t=function(e){function t(t,a,i,r){void 0===a&&(a=null),void 0===i&&(i=!1),void 0===r&&(r=!1),e.call(this,t,i,r),a&&(this._obj=a)}__extends(t,e);var a=__define,i=t,r=i.prototype;return r.clone=function(e){return new t(this.type,e?e:this._obj,this.bubbles,this.cancelable)},r.toString=function(){console.log("GameEvent: ","type","bubbles","cancelable")},a(r,"param",function(){return this._obj}),t}(egret.Event);e.GameEvent=t,egret.registerClass(t,"xd.GameEvent")}(xd||(xd={}));var GameEventConstant=function(){function e(){}var t=(__define,e);t.prototype;return e.GAME_OVER="game_over",e.EXIT="exit",e.RESTART_GAME="restart_game",e}();egret.registerClass(GameEventConstant,"GameEventConstant");var trace=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];for(var a="",i=e.length,r=0;i>r;r++)a+=" "+e[r];console.log(a)},log=function(e,t){trace(e+": ",t)},GameData=function(){function e(){}var t=(__define,e);t.prototype;return e.gridRow=4,e.gridColumn=4,e.gridW=0,e.gridH=0,e.gameHeadHeight=50,e.maxScoreKey="2048_maxScore",e}();egret.registerClass(GameData,"GameData");var GameHead=function(e){function t(){e.call(this)}__extends(t,e);var a=(__define,t),i=a.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this),this.width=this.stage.stageWidth,this.height=GameData.gameHeadHeight;var t=new eui.Rect;t.percentWidth=t.percentHeight=100,t.fillColor=65280,t.ellipseWidth=t.ellipseHeight=20,this.addChild(t);var a=new eui.Group;a.left=10;var i=new eui.HorizontalLayout;i.gap=50,a.layout=i,this.addChild(a),a.verticalCenter=0,this.scoreLabel=new eui.Label,this.scoreLabel.textColor=16776960,this.scoreLabel.size=25,a.addChild(this.scoreLabel),this.maxScoreLabel=new eui.Label,this.maxScoreLabel.textColor=16711680,this.maxScoreLabel.size=25,a.addChild(this.maxScoreLabel);var r=parseFloat(egret.localStorage.getItem(GameData.maxScoreKey));isNaN(r)&&(r=0),this.setData({score:0,maxScore:r}),this.data&&this.setData(this.data)},i.setData=function(e){this.data=e,this.maxScoreLabel&&(this.maxScoreLabel.text="MaxScore: "+e.maxScore),this.scoreLabel&&(this.scoreLabel.text="Score: "+e.score)},t}(eui.Group);egret.registerClass(GameHead,"GameHead");var GameOver=function(e){function t(){e.call(this),this.touchThrough=!1}__extends(t,e);var a=(__define,t),i=a.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this),this.percentWidth=this.percentHeight=100;var t=new eui.Rect;t.percentWidth=100,t.percentHeight=100,t.fillAlpha=.8,t.fillColor=0,this.addChild(t),this.endLabel=new eui.Label("Game Over!"),this.endLabel.size=50,this.addChild(this.endLabel),this.endLabel.touchEnabled=!1,this.endLabel.horizontalCenter=0,this.endLabel.top=200;var a=new eui.Group;this.addChild(a),a.touchChildren=!1,a.touchEnabled=!1,a.horizontalCenter=0,a.top=300;var i=new eui.VerticalLayout;i.horizontalAlign=egret.HorizontalAlign.LEFT,a.layout=i,i.gap=15,this.maxScoreLabel=new eui.Label,this.maxScoreLabel.textColor=16711680,this.maxScoreLabel.size=35,a.addChild(this.maxScoreLabel),this.scoreLabel=new eui.Label,this.scoreLabel.textColor=16776960,this.scoreLabel.size=35,a.addChild(this.scoreLabel),this.buttonContainer=new eui.Group;var r=new eui.HorizontalLayout;r.gap=30,this.buttonContainer.layout=r,this.addChild(this.buttonContainer),this.restart=new eui.Button,this.restart.addEventListener(eui.UIEvent.CREATION_COMPLETE,function(){this.restart.labelDisplay.size=45,this.restart.removeEventListener(eui.UIEvent.CREATION_COMPLETE,arguments.callee,this)},this),this.restart.width=150,this.restart.height=80,this.restart.label="Retry",this.buttonContainer.addChild(this.restart),this.exit=new eui.Button,this.exit.addEventListener(eui.UIEvent.CREATION_COMPLETE,function(){this.exit.labelDisplay.size=45,this.exit.removeEventListener(eui.UIEvent.CREATION_COMPLETE,arguments.callee,this)},this),this.exit.width=150,this.exit.height=80,this.exit.label="Exit",this.buttonContainer.addChild(this.exit),this.buttonContainer.bottom=150,this.buttonContainer.horizontalCenter=0,this.buttonContainer.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClickHandler,this),this.data&&this.setData(this.data)},i.onClickHandler=function(e){var t=e.target;t==this.exit?xd.GameDispatcher.dispatchEvent(GameEventConstant.EXIT):t==this.restart&&xd.GameDispatcher.dispatchEvent(GameEventConstant.RESTART_GAME)},i.setData=function(e){this.data=e,this.maxScoreLabel&&(this.maxScoreLabel.text="MaxScore:  "+e.maxScore),this.scoreLabel&&(this.scoreLabel.text="YourScore:  "+e.score)},t}(eui.Group);egret.registerClass(GameOver,"GameOver");var ExternalInterface=egret.ExternalInterface,GameScene=function(e){function t(){e.call(this),this._gap=5,this._score=0,this._tweenTime=.3,this._randomArr=[],this._mapData=[[],[],[],[]],this._lastP=new egret.Point,this._moveP=new egret.Point}__extends(t,e);var a=(__define,t),i=a.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this),this.width=this.sceneStage.stageWidth,this.height=this.sceneStage.stageHeight,this._bg=new egret.Shape,this.addChild(this._bg),this._bg.y=GameData.gameHeadHeight,this._gameHead=new GameHead,this.addChild(this._gameHead),this._gameHead.top=0,this._gameHead.left=0,GameData.gridW=this.sceneStage.stageWidth/GameData.gridColumn<<0,GameData.gridH=(this.sceneStage.stageHeight-GameData.gameHeadHeight)/GameData.gridRow<<0,this.drawBG(),this.initGame(),xd.GameDispatcher.addEventListener(GameEventConstant.RESTART_GAME,this.onRestartGame,this),xd.GameDispatcher.addEventListener(GameEventConstant.EXIT,this.onExitGame,this),this.addEvent()},i.addEvent=function(){this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this),xd.GameDispatcher.addEventListener(GameEventConstant.GAME_OVER,this.onGameOver,this)},i.removeEvent=function(){xd.GameDispatcher.removeEventListener(GameEventConstant.GAME_OVER,this.onGameOver,this),this.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onTouchBegin,this)},i.onExitGame=function(e){ExternalInterface.call("GameExit","true")},i.onGameOver=function(e){this.removeEvent()},i.onRestartGame=function(e){if(this._gameHead){var t=parseFloat(egret.localStorage.getItem(GameData.maxScoreKey));isNaN(t)&&(t=0),this._gameHead.setData({score:0,maxScore:t})}this._gameOver&&this.contains(this._gameOver)&&this.removeChild(this._gameOver);var a,i,r;for(i=0;i<GameData.gridRow;i++)for(r=0;r<GameData.gridColumn;r++)a=this._mapData[i][r],a&&this.contains(a)&&(this.removeChild(a),a=null);this._mapData=[[],[],[],[]],this.initGame(),this.addEvent()},i.onTouchBegin=function(e){this.sceneStage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.sceneStage.addEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this._lastP.setTo(e.stageX,e.stageY)},i.onTouchMove=function(e){this._moveP.setTo(e.stageX,e.stageY);var t=this._moveP.subtract(this._lastP);if(Math.abs(t.x)>=Math.abs(t.y)){if(t.x>0){if(trace("左右"),!this.fillLeftToRight())return void this.removeMoveEvent()}else if(trace("右左"),!this.fillRightToLeft())return void this.removeMoveEvent()}else if(t.y>0){if(trace("上下"),!this.fillUpToDown())return void this.removeMoveEvent()}else if(trace("下上"),!this.fillDownToUp())return void this.removeMoveEvent();this.onTouchEnd(null)},i.fillLeftToRight=function(){var e,t,a=!1,i=0,r=0,s=0,n=0;for(i=0;i<GameData.gridRow;i++)for(r=GameData.gridColumn-1;r>=0;r--)if(e=this._mapData[i][r]){for(s=r-1;s>=0;s--)if(t=this._mapData[i][s]){if(t.data!=e.data)break;e.data+=t.data,this.updateScore(e.data),this._mapData[i][s]=null,this.setChildIndex(t,this.numChildren-1),TweenMax.to(t,this._tweenTime,{x:e.column*GameData.gridW+this._gap,onComplete:this.onTweenCompleteHandler,onCompleteParams:[this,t]}),a||(a=!0);break}}else for(n=r,s=r-1;s>=0;s--)if(t=this._mapData[i][s]){a||(a=!0),t.column=n,this._mapData[i][n]=t,this._mapData[i][s]=null,TweenMax.to(t,this._tweenTime,{x:GameData.gridW*n+this._gap}),r++;break}return a},i.fillRightToLeft=function(){var e,t,a=!1,i=0,r=0,s=0,n=0;for(i=0;i<GameData.gridRow;i++)for(r=0;r<GameData.gridColumn;r++)if(e=this._mapData[i][r]){for(s=r+1;s<GameData.gridColumn;s++)if(t=this._mapData[i][s]){if(t.data!=e.data)break;e.data+=t.data,this.updateScore(e.data),this._mapData[i][s]=null,this.setChildIndex(t,this.numChildren-1),TweenMax.to(t,this._tweenTime,{x:e.column*GameData.gridW+this._gap,onComplete:this.onTweenCompleteHandler,onCompleteParams:[this,t]}),a||(a=!0);break}}else for(n=r,s=r+1;s<GameData.gridColumn;s++)if(t=this._mapData[i][s]){t.column=n,this._mapData[i][n]=t,this._mapData[i][s]=null,TweenMax.to(t,this._tweenTime,{x:GameData.gridW*n+this._gap}),r--,a||(a=!0);break}return a},i.fillUpToDown=function(){var e,t,a=!1,i=0,r=0,s=0,n=0;for(i=0;i<GameData.gridColumn;i++)for(r=GameData.gridRow-1;r>=0;r--)if(e=this._mapData[r][i]){for(s=r-1;s>=0;s--)if(t=this._mapData[s][i]){if(t.data!=e.data)break;e.data+=t.data,this.updateScore(e.data),this._mapData[s][i]=null,this.setChildIndex(t,this.numChildren-1),TweenMax.to(t,this._tweenTime,{y:e.row*GameData.gridH+this._gap+GameData.gameHeadHeight,onComplete:this.onTweenCompleteHandler,onCompleteParams:[this,t]}),a||(a=!0);break}}else for(n=r,s=r-1;s>=0;s--)if(t=this._mapData[s][i]){t.row=n,this._mapData[n][i]=t,this._mapData[s][i]=null,TweenMax.to(t,this._tweenTime,{y:GameData.gridH*n+this._gap+GameData.gameHeadHeight}),r++,a||(a=!0);break}return a},i.fillDownToUp=function(){var e,t,a=!1,i=0,r=0,s=0,n=0;for(i=0;i<GameData.gridColumn;i++)for(r=0;r<GameData.gridRow;r++)if(e=this._mapData[r][i]){for(s=r+1;s<GameData.gridRow;s++)if(t=this._mapData[s][i]){if(t.data!=e.data)break;e.data+=t.data,this.updateScore(e.data),this._mapData[s][i]=null,this.setChildIndex(t,this.numChildren-1),TweenMax.to(t,this._tweenTime,{y:e.row*GameData.gridH+this._gap+GameData.gameHeadHeight,onComplete:this.onTweenCompleteHandler,onCompleteParams:[this,t]}),a||(a=!0);break}}else for(n=r,s=r+1;s<GameData.gridRow;s++)if(t=this._mapData[s][i]){t.row=n,this._mapData[n][i]=t,this._mapData[s][i]=null,TweenMax.to(t,this._tweenTime,{y:GameData.gridH*n+this._gap+GameData.gameHeadHeight}),r--,a||(a=!0);break}return a},i.onTweenCompleteHandler=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];e[0].removeChild(e[1])},i.removeMoveEvent=function(){this.sceneStage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.sceneStage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this),this.isGameOver()&&this.handlerGameOver()},i.isGameOver=function(){this._randomArr&&(this._randomArr.length=0);var e,t,a;for(t=0;t<GameData.gridRow;t++)for(a=0;a<GameData.gridColumn;a++)e=this._mapData[t][a],e||this._randomArr.push({row:t,column:a});return 0==this._randomArr.length},i.onTouchEnd=function(e){this.sceneStage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.onTouchMove,this),this.sceneStage.removeEventListener(egret.TouchEvent.TOUCH_END,this.onTouchEnd,this);var t=this.isGameOver();if(t)this.handlerGameOver();else{var a=Math.random()*this._randomArr.length<<0;if(a>-1){var i=this._randomArr[a],r=this.getRandomGrid(),s=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];this.addChild(e[0]),e[0].alpha=0,TweenMax.to(e[0],this._tweenTime,{alpha:1})};TweenMax.delayedCall(.2,s,[r],this),r.row=i.row,r.column=i.column,r.x=i.column*GameData.gridW+this._gap,r.y=i.row*GameData.gridH+this._gap+GameData.gameHeadHeight,this._mapData[i.row][i.column]=r}}},i.handlerGameOver=function(){this._gameOver||(this._gameOver=new GameOver),this.contains(this._gameOver)||this.addChild(this._gameOver);var e=parseFloat(egret.localStorage.getItem(GameData.maxScoreKey));isNaN(e)&&(e=0),this._score>e&&(egret.localStorage.setItem(GameData.maxScoreKey,this._score.toString()),e=this._score),this._gameOver.setData({score:this._score,maxScore:e}),xd.GameDispatcher.dispatchEvent(GameEventConstant.GAME_OVER)},i.drawBG=function(){if(this._bg){this._bg.graphics.clear(),this._bg.graphics.beginFill(15987706),this._bg.graphics.lineStyle(1,0);for(var e=0;e<GameData.gridRow;e++)for(var t=0;t<GameData.gridColumn;t++)this._bg.graphics.drawRect(t*GameData.gridW,e*GameData.gridH,GameData.gridW,GameData.gridH);this._bg.graphics.endFill()}},i.initGame=function(){var e=this.getRandom(GameData.gridRow),t=this.getRandom(GameData.gridColumn),a=this.getRandomGrid();this.addChild(a),a.row=e,a.column=t,a.x=t*GameData.gridW+this._gap,a.y=e*GameData.gridH+this._gap+GameData.gameHeadHeight,this._mapData[e][t]=a;var i=this.getRandom(GameData.gridRow);if(i!=e)e=i;else{for(;;)if((i=this.getRandom(GameData.gridRow))!=e)break;e=i}t=this.getRandom(GameData.gridColumn),a=this.getRandomGrid(),this.addChild(a),a.row=e,a.column=t,a.x=t*GameData.gridW+this._gap,a.y=e*GameData.gridH+this._gap+GameData.gameHeadHeight,this._mapData[e][t]=a},i.getRandom=function(e){return Math.random()*e<<0},i.getRandomGrid=function(){var e=new NumGrid;return e.data=Math.random()>.5?2:4,e},i.updateScore=function(e){if(this._score+=e,this._gameHead){var t=parseFloat(egret.localStorage.getItem(GameData.maxScoreKey));isNaN(t)&&(t=0),this._gameHead.setData({score:this._score,maxScore:t})}},t}(eui.Group);egret.registerClass(GameScene,"GameScene");var NumGrid=function(e){function t(){e.call(this),this.row=0,this.column=0,this.touchChildren=!1,this.touchEnabled=!1}__extends(t,e);var a=__define,i=t,r=i.prototype;return r.createChildren=function(){e.prototype.createChildren.call(this),this.width=GameData.gridW-10,this.height=GameData.gridH-10,this._grid=new egret.Shape,this._grid.touchEnabled=!1,this.addChild(this._grid),this._num=new eui.Label,this.addChild(this._num),this._num.touchEnabled=!1,this._num.bold=!0,this._num.size=50,this._num.textColor=16777215,this._num.horizontalCenter=0,this._num.verticalCenter=0,isNaN(this._data)||(this.data=this._data)},a(r,"data",function(){return this._data},function(e){this._data=e,this._num&&(this._num.text=e.toString(),e>999?this._num.size=25:e>100&&(this._num.size=30)),this._grid&&(this._grid.graphics.clear(),this._grid.graphics.lineStyle(1,0,.2,!0),this._grid.graphics.beginFill(this.getColor(e),1),this._grid.graphics.drawCircle(.5*this.width,.5*this.height,.5*this.width),this._grid.graphics.endFill())}),r.getColor=function(e){var t=0;switch(e){case 2:t=ColorUtils.getColorValue(238,228,218);break;case 4:t=ColorUtils.getColorValue(238,224,198);break;case 8:t=ColorUtils.getColorValue(243,243,116);break;case 16:t=ColorUtils.getColorValue(243,177,116);break;case 32:t=ColorUtils.getColorValue(248,149,90);break;case 64:t=ColorUtils.getColorValue(249,94,50);break;case 128:t=ColorUtils.getColorValue(239,207,108);break;case 256:t=ColorUtils.getColorValue(239,207,99);break;case 512:t=ColorUtils.getColorValue(239,203,82);break;case 1024:t=ColorUtils.getColorValue(239,199,57);break;case 2048:t=ColorUtils.getColorValue(239,195,41);break;case 4096:t=ColorUtils.getColorValue(255,60,57)}return t},t}(eui.Group);egret.registerClass(NumGrid,"NumGrid");var LoadingUI=function(e){function t(){e.call(this),this.createView()}__extends(t,e);var a=(__define,t),i=a.prototype;return i.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},i.setProgress=function(e,t){this.textField.text="Loading..."+e+"/"+t},t}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(e){function t(){e.apply(this,arguments),this.isThemeLoadEnd=!1,this.isResourceLoadEnd=!1}__extends(t,e);var a=(__define,t),i=a.prototype;return i.createChildren=function(){e.prototype.createChildren.call(this),this.stage.frameRate=60,this.stage.scaleMode=egret.StageScaleMode.SHOW_ALL;var t=new AssetAdapter;this.stage.registerImplementation("eui.IAssetAdapter",t),this.stage.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},i.onConfigComplete=function(e){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var t=new eui.Theme("resource/default.thm.json",this.stage);t.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},i.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},i.onResourceLoadComplete=function(e){"preload"==e.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.isResourceLoadEnd=!0,this.createScene())},i.createScene=function(){this.isThemeLoadEnd&&this.isResourceLoadEnd&&this.startCreateScene()},i.onItemLoadError=function(e){console.warn("Url:"+e.resItem.url+" has failed to load")},i.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},i.onResourceProgress=function(e){"preload"==e.groupName&&this.loadingView.setProgress(e.itemsLoaded,e.itemsTotal)},i.startCreateScene=function(){var e=new GameScene;e.sceneStage=this.stage,this.addChild(e)},t}(eui.UILayer);egret.registerClass(Main,"Main");var ThemeAdapter=function(){function e(){}var t=(__define,e),a=t.prototype;return a.getTheme=function(e,t,a,i){function r(e){t.call(i,e)}function s(t){t.resItem.url==e&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),a.call(i))}RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,s,null),RES.getResByUrl(e,r,this,RES.ResourceItem.TYPE_TEXT)},e}();egret.registerClass(ThemeAdapter,"ThemeAdapter",["eui.IThemeAdapter"]);